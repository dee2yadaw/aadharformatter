<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aadhaar A4 Formatter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .a4-canvas-container {
            width: 100%;
            max-width: 21cm;
            aspect-ratio: 210 / 297; /* A4 aspect ratio */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .active-filter {
            background-color: #3b82f6 !important; /* blue-500 */
            color: white !important;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl bg-white rounded-lg shadow-xl p-4 sm:p-8">
        <div class="text-center mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Aadhaar Card A4 Formatter</h1>
            <p class="text-gray-500 mt-2 text-sm sm:text-base">Upload your card images to format them onto a printable A4 sheet.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            
            <div class="space-y-6">
                <div>
                    <label for="front-upload" class="block text-lg font-semibold text-gray-700 mb-2">1. Upload Front Side</label>
                    <input type="file" id="front-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-colors duration-200 cursor-pointer">
                    <div id="front-preview-container" class="mt-4 hidden border-2 border-dashed border-gray-300 rounded-lg p-2 text-center">
                        <img id="front-preview" class="max-h-48 mx-auto rounded" alt="Front side preview">
                        <p class="text-xs text-gray-500 mt-2">Front Preview</p>
                    </div>
                </div>

                <div>
                    <label for="back-upload" class="block text-lg font-semibold text-gray-700 mb-2">2. Upload Back Side</label>
                    <input type="file" id="back-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition-colors duration-200 cursor-pointer">
                    <div id="back-preview-container" class="mt-4 hidden border-2 border-dashed border-gray-300 rounded-lg p-2 text-center">
                        <img id="back-preview" class="max-h-48 mx-auto rounded" alt="Back side preview">
                        <p class="text-xs text-gray-500 mt-2">Back Preview</p>
                    </div>
                </div>

                <div class="pt-4 space-y-4">
                    <div>
                         <h3 class="text-lg font-semibold text-gray-700">3. Download Your File</h3>
                         <p class="text-sm text-gray-500 mb-4">Once both images are uploaded, the A4 preview will be generated for download.</p>
                         <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button id="download-pdf" disabled class="w-full bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 transition-all duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                <span>Download PDF</span>
                            </button>
                            <button id="download-png" disabled class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-all duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                <span>Download PNG</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="pt-4 space-y-2">
                    <h3 class="text-lg font-semibold text-gray-700">4. Apply a Filter (Optional)</h3>
                    <div id="filter-container" class="grid grid-cols-3 sm:grid-cols-5 gap-2">
                        <button data-filter="default" class="filter-btn active-filter text-sm py-2 px-3 rounded-md bg-gray-200 text-gray-800 font-semibold transition-all duration-200">Default</button>
                        <button data-filter="chrome" class="filter-btn text-sm py-2 px-3 rounded-md bg-gray-200 text-gray-800 font-semibold transition-all duration-200">Chrome</button>
                        <button data-filter="fade" class="filter-btn text-sm py-2 px-3 rounded-md bg-gray-200 text-gray-800 font-semibold transition-all duration-200">Fade</button>
                        <button data-filter="cold" class="filter-btn text-sm py-2 px-3 rounded-md bg-gray-200 text-gray-800 font-semibold transition-all duration-200">Cold</button>
                        <button data-filter="warm" class="filter-btn text-sm py-2 px-3 rounded-md bg-gray-200 text-gray-800 font-semibold transition-all duration-200">Warm</button>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center mt-8 md:mt-0">
                 <h2 class="text-lg font-semibold text-gray-700 mb-2">A4 Paper Preview</h2>
                 <div class="a4-canvas-container bg-white p-2 sm:p-4">
                    <canvas id="a4-canvas"></canvas>
                 </div>
            </div>
        </div>
    </div>
    
    <footer class="text-center mt-8 text-gray-500 text-sm">
        <p>Tool created by Gemini. All processing is done in your browser; no data is uploaded.</p>
    </footer>

    <script>
        const frontUpload = document.getElementById('front-upload');
        const backUpload = document.getElementById('back-upload');
        const frontPreviewContainer = document.getElementById('front-preview-container');
        const frontPreview = document.getElementById('front-preview');
        const backPreviewContainer = document.getElementById('back-preview-container');
        const backPreview = document.getElementById('back-preview');
        
        const canvas = document.getElementById('a4-canvas');
        const ctx = canvas.getContext('2d');
        const downloadPdfBtn = document.getElementById('download-pdf');
        const downloadPngBtn = document.getElementById('download-png');
        const filterButtons = document.querySelectorAll('.filter-btn');

        let frontImage = null;
        let backImage = null;
        let activeFilter = 'default';

        const A4_WIDTH_PX = 2480;
        const A4_HEIGHT_PX = 3508;
        
        canvas.width = A4_WIDTH_PX;
        canvas.height = A4_HEIGHT_PX;
        canvas.style.width = '100%';
        canvas.style.height = '100%';

        function handleFileUpload(event, isFront) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    if (isFront) {
                        frontImage = img;
                        frontPreview.src = img.src;
                        frontPreviewContainer.classList.remove('hidden');
                    } else {
                        backImage = img;
                        backPreview.src = img.src;
                        backPreviewContainer.classList.remove('hidden');
                    }
                    drawOnCanvas();
                };
            };
            reader.readAsDataURL(file);
             // Reset the input value to allow re-uploading the same file
            event.target.value = '';
        }

        function drawOnCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!frontImage && !backImage) {
                ctx.fillStyle = 'gray';
                ctx.font = '50px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Upload images to see the preview', canvas.width / 2, canvas.height / 2);
            }
            
            downloadPdfBtn.disabled = true;
            downloadPngBtn.disabled = true;
            
            if (frontImage && backImage) {
                downloadPdfBtn.disabled = false;
                downloadPngBtn.disabled = false;
            }
            
            const DPI = 300;
            const INCH_TO_MM = 25.4;
            // Increased card size again for maximum visibility.
            const cardWidthMM = 97.5; // Increased from 92.5
            const cardHeightMM = 61.48; // Increased from 58.33 to maintain aspect ratio

            const cardWidthPx = (cardWidthMM / INCH_TO_MM) * DPI;
            const cardHeightPx = (cardHeightMM / INCH_TO_MM) * DPI;
            const marginLeftPx = (5 / INCH_TO_MM) * DPI; // Side margin
            const marginTopPx = (20 / INCH_TO_MM) * DPI; // Increased top margin to move images down
            const spacingPx = (5 / INCH_TO_MM) * DPI; 

            const applyFilter = (filterName, drawFunction) => {
                const originalFilter = ctx.filter;
                switch (filterName) {
                    case 'chrome':
                        ctx.filter = 'saturate(1.6) contrast(1.1)';
                        break;
                    case 'fade':
                        ctx.filter = 'saturate(0.8) contrast(0.9) brightness(1.1)';
                        break;
                    default:
                        ctx.filter = 'none';
                }
                const drawnRect = drawFunction(); // Execute the draw and get the image's dimensions
                ctx.filter = originalFilter;

                // Overlays need to be drawn after the image, using the returned dimensions
                if (filterName === 'warm') {
                    ctx.globalCompositeOperation = 'multiply';
                    ctx.fillStyle = 'rgba(255, 165, 0, 0.15)';
                    ctx.fillRect(drawnRect.x, drawnRect.y, drawnRect.w, drawnRect.h);
                    ctx.globalCompositeOperation = 'source-over'; // Reset
                } else if (filterName === 'cold') {
                    ctx.globalCompositeOperation = 'multiply';
                    ctx.fillStyle = 'rgba(0, 150, 255, 0.15)';
                    ctx.fillRect(drawnRect.x, drawnRect.y, drawnRect.w, drawnRect.h);
                    ctx.globalCompositeOperation = 'source-over'; // Reset
                }
            };
            
            // Maintain aspect ratio while fitting the standard size
            function drawImageKeepAspectRatio(img, x, y, w, h) {
                const imgRatio = img.width / img.height;
                const canvasRatio = w / h;

                let drawX, drawY, drawW, drawH;

                if (imgRatio > canvasRatio) {
                    const newHeight = w / imgRatio;
                    drawX = x;
                    drawY = y + (h - newHeight) / 2
                    drawW = w;
                    drawH = newHeight;
                } else {
                    const newWidth = h * imgRatio;
                    drawX = x + (w - newWidth) / 2;
                    drawY = y;
                    drawW = newWidth;
                    drawH = h;
                }
                ctx.drawImage(img, drawX, drawY, drawW, drawH);
                // Return the actual dimensions and position of the drawn image
                return { x: drawX, y: drawY, w: drawW, h: drawH };
            }

            if (frontImage) applyFilter(activeFilter, () => drawImageKeepAspectRatio(frontImage, marginLeftPx, marginTopPx, cardWidthPx, cardHeightPx));
            if (backImage) applyFilter(activeFilter, () => drawImageKeepAspectRatio(backImage, marginLeftPx + cardWidthPx + spacingPx, marginTopPx, cardWidthPx, cardHeightPx));
        }

        frontUpload.addEventListener('change', (e) => handleFileUpload(e, true));
        backUpload.addEventListener('change', (e) => handleFileUpload(e, false));

        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active-filter'));
                button.classList.add('active-filter');
                activeFilter = button.dataset.filter;
                drawOnCanvas();
            });
        });

        downloadPngBtn.addEventListener('click', () => {
            if (!frontImage || !backImage) return;
            const link = document.createElement('a');
            link.download = 'aadhaar-a4.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        downloadPdfBtn.addEventListener('click', () => {
            if (!frontImage || !backImage) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            const imgData = canvas.toDataURL('image/png', 1.0);
            doc.addImage(imgData, 'PNG', 0, 0, 210, 297);
            doc.save('aadhaar-a4.pdf');
        });

        window.onload = drawOnCanvas;
    </script>
</body>
</html>


